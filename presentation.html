<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>LitIt Infrastructure â€“ Live Mermaid Presentation ðŸŒ´</title>
<style>
  body { font-family: Poppins, sans-serif; margin: 0; transition: background .5s, color .5s; }
  header, footer { position: sticky; top: 0; padding: .5rem; text-align: center; background: inherit; }
  nav a { margin: 0 .5rem; text-decoration: none; color: inherit; font-weight: 600; }
  .slide { display: none; padding: 2rem; text-align: center; }
  .mermaid { margin: 1rem auto; max-width: 90%; }
  textarea.mmd { width: 90%; height: 200px; margin: 1rem auto; display: block;
                 font-family: monospace; font-size: 14px; }
  footer { position: fixed; bottom: 10px; width: 100%; text-align: center; }
  button { background: #FF6F61; color: #fff; border: none; padding: .5rem 1rem;
           border-radius: 6px; font-weight: 600; cursor: pointer; margin: 0 .3rem; }
  @media (prefers-color-scheme: dark){
    body { background: #0B132B; color: #E0E0E0; }
    button { background: #4ABDAC; }
  }
</style>
</head>
<body>

<header>
  <h1>LitIt Platform Infrastructure ðŸŒ´</h1>
  <nav id="nav"></nav>
</header>

<main id="slides"></main>

<footer>
  <button id="prev">â—€ Prev</button>
  <button id="next">Next â–¶</button>
  <button id="toggleView">View All</button>
  <button id="toggleEdit">Toggle Edit Mode</button>
</footer>

<script type="module">
import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs";
mermaid.initialize({ startOnLoad:false, theme:"default" });

const diagrams = [
  { title:"01 Overview", desc:"High-level architecture", mmd:`graph TD
  subgraph "Clients"
    A1["Android / iOS / PWA"]
    A2["Web Admin Portal (Next.js)"]
  end
  subgraph "Network"
    B1["Caddy / Nginx (HTTP/2, TLS, Brotli)"]
  end
  subgraph "Backend"
    C1["Go Fiber Monolith"]
    C2["REST API + WebSocket Hub"]
  end
  subgraph "Services"
    D1["PostgreSQL"]
    D2["Redis"]
    D3["Meilisearch"]
    D4["Gotify"]
    D5["Bunny CDN"]
  end
  subgraph "DevOps & Monitoring"
    E1["GitHub Actions"]
    E2["Portainer + Watchtower"]
    F1["Prometheus / Grafana / Loki"]
  end
  A1 -->|HTTPS| B1 --> C1
  A2 -->|Admin| B1
  C1 --> D1 & D2 & D3 & D4 & D5
  E1 --> E2 --> C1
  C1 --> F1` },

  { title:"02 Backend Monolith", desc:"Go Fiber internal modules", mmd:`graph LR
  subgraph "Go Fiber Monolith"
    A["/internal/common<br>Config Â· DB Â· Logger Â· Redis"]
    B["/internal/ws<br>Gotify Bridge + Fallback Hub"]
    C["/internal/api<br>Public REST (v1)"]
    D["/internal/admin<br>Role-based Routes"]
    E["/internal/content<br>Media Pipeline"]
    F["/internal/auth<br>JWT + Device Binding"]
    G["/internal/payments<br>Braintree / Stripe"]
    H["/internal/ai<br>Gemini & ML Utilities"]
  end
  A --> B & C & D & E & F & G & H
  E -->|Uploads| Bunny
  F -->|Tokens| Redis` },

  { title:"03 Internal Services", desc:"Background workers and pipelines", mmd:`graph TD
  subgraph "Internal Services"
    A["content.service.go"]
    B["auth.service.go"]
    C["payments.service.go"]
    D["search.indexer.go"]
    E["notification.service.go"]
    F["scheduler.cron.go"]
  end
  A -->|Media Uploads| Bunny
  B -->|JWT Issue| Redis
  C -->|Sync| Postgres
  D -->|Index Build| Meilisearch
  E -->|Push| Gotify
  F -->|Cache Cleanup| Redis` },

  { title:"04 Database & Storage", desc:"Persistent data layer", mmd:`graph LR
  A["PostgreSQL<br>Primary ACID DB"]
  B["Redis 7<br>Cache / Sessions"]
  C["Meilisearch<br>Search Index"]
  D["Bunny.net<br>CDN / Object Storage"]
  E["Backups â†’ Azure Blob"]
  A --> E
  B --> A
  C --> A
  D --> A` },

  { title:"05 Mobile App & UI", desc:"Flutter endpoints and flows", mmd:`graph TD
  subgraph "Mobile App (Flutter)"
    A1["Login / Register<br>/api/auth/*"]
    A2["Dashboard<br>/api/feed/*"]
    A3["Casting Calls<br>/api/cast/*"]
    A4["Messages<br>/api/chat/*"]
    A5["Profile Edit<br>/api/user/*"]
    A6["Media Upload<br>/api/content/upload"]
  end
  A1 --> A2 --> A3 --> A4 --> A5 --> A6
  A4 -->|WebSocket /ws| Gotify` },

  { title:"06 CI/CD & Monitoring", desc:"DevOps & observability stack", mmd:`graph LR
  subgraph "CI/CD"
    A["GitHub Actions"]
    B["Docker Build + Push (GHCR)"]
    C["Portainer Deploy"]
    D["Watchtower Auto-Update"]
  end
  subgraph "Monitoring"
    E["Prometheus"]
    F["Grafana"]
    G["Loki Logs"]
  end
  A --> B --> C --> D
  D --> E --> F --> G` },

  { title:"07 Security & Network", desc:"Auth, TLS, and WAF layers", mmd:`graph TD
  A["JWT Auth (HS256 / ES256)"]
  B["Device Binding (Mobile)"]
  C["Role-Based Access (/admin/*)"]
  D["TLS Auto-Renew (Caddy)"]
  E["Cloudflare WAF (DDoS Protection)"]
  A --> B --> C --> D --> E` },

  { title:"08 Marketing & Analytics", desc:"Tracking and analytics stack", mmd:`graph LR
  A["Google Analytics / Firebase"]
  B["Meilisearch Logs"]
  C["Bunny Analytics"]
  D["Redis Counters"]
  E["Prometheus / Grafana"]
  A --> B --> C --> D --> E` }
];

const slides=document.getElementById('slides');
const nav=document.getElementById('nav');
let idx=0, all=false, editMode=false;

function buildSlides(){
  slides.innerHTML=''; nav.innerHTML='';
  diagrams.forEach((d,i)=>{
    const sec=document.createElement('section');
    sec.className='slide';
    sec.id=`slide-${i}`;
    sec.innerHTML=`
      <h2>${d.title}</h2>
      <p>${d.desc}</p>
      <textarea class="mmd" style="display:none;">${d.mmd}</textarea>
      <button class="render-btn" style="display:none;">Render</button>
      <div class="mermaid">${d.mmd}</div>`;
    slides.appendChild(sec);
    const link=document.createElement('a');
    link.textContent=d.title; link.href="#"; link.onclick=(e)=>{e.preventDefault();show(i)};
    nav.appendChild(link);
  });
  renderAll();
}

async function renderAll(){
  try { await mermaid.run({ querySelector: '.mermaid' }); }
  catch(e){ console.error(e); }
}

function show(i){
  idx=i;
  document.querySelectorAll('.slide').forEach((s,j)=>s.style.display=(all||j===i)?'block':'none');
  renderAll();
}

function toggleView(){ all=!all; show(idx); }

function toggleEdit(){
  editMode=!editMode;
  document.querySelectorAll('.mmd').forEach(t=>t.style.display=editMode?'block':'none');
  document.querySelectorAll('.render-btn').forEach(b=>b.style.display=editMode?'inline-block':'none');
}

function attachButtons(){
  document.querySelectorAll('.render-btn').forEach(btn=>{
    btn.onclick=async()=>{
      const wrap=btn.parentElement;
      const code=wrap.querySelector('.mmd').value;
      const out=wrap.querySelector('.mermaid');
      out.innerHTML=code;
      await mermaid.run({ nodes:[out] });
    };
  });
}

document.getElementById('next').onclick=()=>{idx=(idx+1)%diagrams.length;show(idx);};
document.getElementById('prev').onclick=()=>{idx=(idx-1+diagrams.length)%diagrams.length;show(idx);};
document.getElementById('toggleView').onclick=toggleView;
document.getElementById('toggleEdit').onclick=toggleEdit;

buildSlides();
attachButtons();
show(0);
</script>
</body>
</html>
