<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>LitIt Platform Infrastructure â€“ Live & Visual Mermaid ðŸŒ´</title>
<style>
  body{font-family:Poppins,sans-serif;margin:0;padding:1rem;background:#0B132B;color:#E0E0E0;}
  h1{text-align:center;color:#4ABDAC;}
  section{margin:2rem auto;max-width:95%;}
  .mermaid{margin:1rem auto;max-width:90%;background:#fff;color:#000;border-radius:8px;padding:0.5rem;}
  textarea{width:90%;height:200px;margin:1rem auto;display:block;font-family:monospace;font-size:14px;}
  button{background:#4ABDAC;color:#fff;border:none;padding:.4rem .8rem;border-radius:6px;
         font-weight:600;cursor:pointer;margin:.2rem;}
  a.editlink{background:#FF6F61;color:white;text-decoration:none;padding:.4rem .8rem;border-radius:6px;
             margin-left:.3rem;font-weight:600;}
  @media(prefers-color-scheme:light){
    body{background:#fff;color:#23303B;}
    .mermaid{background:#f8f9fa;}
    h1{color:#FF6F61;}
    button{background:#FF6F61;}
  }
</style>
</head>
<body>

<h1>LitIt Platform Infrastructure ðŸŒ´</h1>
<div id="slides"></div>

<script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
<script>
mermaid.initialize({ startOnLoad:true, theme:"default" });

// ---- helper to encode and open in MermaidChart visual editor ----
function openVisualEditor(code){
  // MermaidChart supports ?code=<urlencoded text>
  const encoded = encodeURIComponent(code);
  window.open(`https://www.mermaidchart.com/app/editor?code=${encoded}`, "_blank");
}

// ---- diagrams ----
const diagrams=[
 {title:"01 Overview",desc:"High-level architecture",mmd:`graph TD
  subgraph "Clients"
    A1["Android / iOS / PWA"]
    A2["Web Admin Portal (Next.js)"]
  end
  subgraph "Network"
    B1["Caddy / Nginx (HTTP/2, TLS, Brotli)"]
  end
  subgraph "Backend"
    C1["Go Fiber Monolith"]
    C2["REST API + WebSocket Hub"]
  end
  subgraph "Services"
    D1["PostgreSQL"]
    D2["Redis"]
    D3["Meilisearch"]
    D4["Gotify"]
    D5["Bunny CDN"]
  end
  subgraph "DevOps & Monitoring"
    E1["GitHub Actions"]
    E2["Portainer + Watchtower"]
    F1["Prometheus / Grafana / Loki"]
  end
  A1 -->|HTTPS| B1 --> C1
  A2 -->|Admin| B1
  C1 --> D1 & D2 & D3 & D4 & D5
  E1 --> E2 --> C1
  C1 --> F1`},

 {title:"02 Backend Monolith",desc:"Go Fiber internal modules",mmd:`graph LR
  subgraph "Go Fiber Monolith"
    A["/internal/common â€“ Config Â· DB Â· Logger Â· Redis"]
    B["/internal/ws â€“ Gotify Bridge + Fallback Hub"]
    C["/internal/api â€“ Public REST (v1)"]
    D["/internal/admin â€“ Role-based Routes"]
    E["/internal/content â€“ Media Pipeline"]
    F["/internal/auth â€“ JWT + Device Binding"]
    G["/internal/payments â€“ Braintree / Stripe"]
    H["/internal/ai â€“ Gemini & ML Utilities"]
  end
  A --> B & C & D & E & F & G & H
  E -->|Uploads| Bunny
  F -->|Tokens| Redis`},

 {title:"03 Internal Services",desc:"Workers and pipelines",mmd:`graph TD
  subgraph "Internal Services"
    A["content.service.go"]
    B["auth.service.go"]
    C["payments.service.go"]
    D["search.indexer.go"]
    E["notification.service.go"]
    F["scheduler.cron.go"]
  end
  A -->|Media Uploads| Bunny
  B -->|JWT Issue| Redis
  C -->|Sync| Postgres
  D -->|Index Build| Meilisearch
  E -->|Push| Gotify
  F -->|Cache Cleanup| Redis`},

 {title:"04 Database & Storage",desc:"Persistence layer",mmd:`graph LR
  A["PostgreSQL â€“ Primary ACID DB"]
  B["Redis 7 â€“ Cache / Sessions"]
  C["Meilisearch â€“ Search Index"]
  D["Bunny.net â€“ CDN / Object Storage"]
  E["Backups â†’ Azure Blob"]
  A --> E
  B --> A
  C --> A
  D --> A`},

 {title:"05 Mobile App & UI",desc:"Flutter endpoints",mmd:`graph TD
  subgraph "Mobile App (Flutter)"
    A1["Login / Register /api/auth/*"]
    A2["Dashboard /api/feed/*"]
    A3["Casting Calls /api/cast/*"]
    A4["Messages /api/chat/*"]
    A5["Profile Edit /api/user/*"]
    A6["Media Upload /api/content/upload"]
  end
  A1 --> A2 --> A3 --> A4 --> A5 --> A6
  A4 -->|WebSocket /ws| Gotify`},

 {title:"06 CI/CD & Monitoring",desc:"DevOps workflow",mmd:`graph LR
  subgraph "CI/CD"
    A["GitHub Actions"]
    B["Docker Build + Push (GHCR)"]
    C["Portainer Deploy"]
    D["Watchtower Auto-Update"]
  end
  subgraph "Monitoring"
    E["Prometheus"]
    F["Grafana"]
    G["Loki Logs"]
  end
  A --> B --> C --> D
  D --> E --> F --> G`},

 {title:"07 Security & Network",desc:"Auth / TLS / WAF",mmd:`graph TD
  A["JWT Auth (HS256 / ES256)"]
  B["Device Binding (Mobile)"]
  C["Role-Based Access (/admin/*)"]
  D["TLS Auto-Renew (Caddy)"]
  E["Cloudflare WAF (DDoS Protection)"]
  A --> B --> C --> D --> E`},

 {title:"08 Marketing & Analytics",desc:"Tracking and analytics",mmd:`graph LR
  A["Google Analytics / Firebase"]
  B["Meilisearch Logs"]
  C["Bunny Analytics"]
  D["Redis Counters"]
  E["Prometheus / Grafana"]
  A --> B --> C --> D --> E`}
];

// ---- render all diagrams with textareas + buttons ----
const slides=document.getElementById("slides");
diagrams.forEach((d,i)=>{
  const sec=document.createElement("section");
  sec.innerHTML=`<h2>${d.title}</h2><p>${d.desc}</p>
  <textarea id="txt${i}">${d.mmd}</textarea><br>
  <button onclick="reRender(${i})">Render</button>
  <a class="editlink" href="#" onclick="openVisualEditor(document.getElementById('txt${i}').value);return false;">Open in Visual Editor â†—</a>
  <div id="out${i}" class="mermaid">${d.mmd}</div>`;
  slides.appendChild(sec);
});

async function reRender(i){
  const code=document.getElementById("txt"+i).value;
  const out=document.getElementById("out"+i);
  out.innerHTML=code;
  try{await mermaid.run({nodes:[out]});}
  catch(e){out.textContent="Render error: "+e.message;}
}
</script>
</body>
</html>
