<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>LitIt Platform Infrastructure â€“ Live Mermaid ðŸŒ´</title>
<style>
  body { font-family:Poppins,sans-serif;margin:0;padding:1rem;
         background:#0B132B;color:#E0E0E0;transition:background .5s,color .5s; }
  h1 { text-align:center;margin-top:0.5rem;color:#4ABDAC; }
  section { margin:3rem auto;max-width:95%; }
  .mermaid { margin:1rem auto;max-width:90%;background:#fff;color:#000;
             border-radius:8px;padding:0.5rem; }
  button { background:#4ABDAC;color:#fff;border:none;padding:.5rem 1rem;
           border-radius:6px;font-weight:600;cursor:pointer;margin:.2rem; }
  footer { position:fixed;bottom:10px;width:100%;text-align:center; }
  @media(prefers-color-scheme:light){
    body{background:#fff;color:#23303B;}
    .mermaid{background:#f8f9fa;}
    h1{color:#FF6F61;}
    button{background:#FF6F61;}
  }
</style>
</head>
<body>

<h1>LitIt Platform Infrastructure ðŸŒ´</h1>

<!-- 01 Overview -->
<section>
<h2>01 Overview</h2>
<div class="mermaid">
graph TD
  subgraph "Clients"
    A1["Android / iOS / PWA"]
    A2["Web Admin Portal (Next.js)"]
  end
  subgraph "Network"
    B1["Caddy / Nginx (HTTP/2, TLS, Brotli)"]
  end
  subgraph "Backend"
    C1["Go Fiber Monolith"]
    C2["REST API + WebSocket Hub"]
  end
  subgraph "Services"
    D1["PostgreSQL"]
    D2["Redis"]
    D3["Meilisearch"]
    D4["Gotify"]
    D5["Bunny CDN"]
  end
  subgraph "DevOps & Monitoring"
    E1["GitHub Actions"]
    E2["Portainer + Watchtower"]
    F1["Prometheus / Grafana / Loki"]
  end
  A1 -->|HTTPS| B1 --> C1
  A2 -->|Admin| B1
  C1 --> D1 & D2 & D3 & D4 & D5
  E1 --> E2 --> C1
  C1 --> F1
</div>
</section>

<!-- 02 Backend Monolith -->
<section>
<h2>02 Backend Monolith</h2>
<div class="mermaid">
graph LR
  subgraph "Go Fiber Monolith"
    A["/internal/common â€“ Config Â· DB Â· Logger Â· Redis"]
    B["/internal/ws â€“ Gotify Bridge + Fallback Hub"]
    C["/internal/api â€“ Public REST (v1)"]
    D["/internal/admin â€“ Role-based Routes"]
    E["/internal/content â€“ Media Pipeline"]
    F["/internal/auth â€“ JWT + Device Binding"]
    G["/internal/payments â€“ Braintree / Stripe"]
    H["/internal/ai â€“ Gemini & ML Utilities"]
  end
  A --> B & C & D & E & F & G & H
  E -->|Uploads| Bunny
  F -->|Tokens| Redis
</div>
</section>

<!-- 03 Internal Services -->
<section>
<h2>03 Internal Services</h2>
<div class="mermaid">
graph TD
  subgraph "Internal Services"
    A["content.service.go"]
    B["auth.service.go"]
    C["payments.service.go"]
    D["search.indexer.go"]
    E["notification.service.go"]
    F["scheduler.cron.go"]
  end
  A -->|Media Uploads| Bunny
  B -->|JWT Issue| Redis
  C -->|Sync| Postgres
  D -->|Index Build| Meilisearch
  E -->|Push| Gotify
  F -->|Cache Cleanup| Redis
</div>
</section>

<!-- 04 Database & Storage -->
<section>
<h2>04 Database & Storage</h2>
<div class="mermaid">
graph LR
  A["PostgreSQL â€“ Primary ACID DB"]
  B["Redis 7 â€“ Cache / Sessions"]
  C["Meilisearch â€“ Search Index"]
  D["Bunny.net â€“ CDN / Object Storage"]
  E["Backups â†’ Azure Blob"]
  A --> E
  B --> A
  C --> A
  D --> A
</div>
</section>

<!-- 05 Mobile App & UI -->
<section>
<h2>05 Mobile App & UI</h2>
<div class="mermaid">
graph TD
  subgraph "Mobile App (Flutter)"
    A1["Login / Register /api/auth/*"]
    A2["Dashboard /api/feed/*"]
    A3["Casting Calls /api/cast/*"]
    A4["Messages /api/chat/*"]
    A5["Profile Edit /api/user/*"]
    A6["Media Upload /api/content/upload"]
  end
  A1 --> A2 --> A3 --> A4 --> A5 --> A6
  A4 -->|WebSocket /ws| Gotify
</div>
</section>

<!-- 06 CI/CD & Monitoring -->
<section>
<h2>06 CI/CD & Monitoring</h2>
<div class="mermaid">
graph LR
  subgraph "CI/CD"
    A["GitHub Actions"]
    B["Docker Build + Push (GHCR)"]
    C["Portainer Deploy"]
    D["Watchtower Auto-Update"]
  end
  subgraph "Monitoring"
    E["Prometheus"]
    F["Grafana"]
    G["Loki Logs"]
  end
  A --> B --> C --> D
  D --> E --> F --> G
</div>
</section>

<!-- 07 Security & Network -->
<section>
<h2>07 Security & Network</h2>
<div class="mermaid">
graph TD
  A["JWT Auth (HS256 / ES256)"]
  B["Device Binding (Mobile)"]
  C["Role-Based Access (/admin/*)"]
  D["TLS Auto-Renew (Caddy)"]
  E["Cloudflare WAF (DDoS Protection)"]
  A --> B --> C --> D --> E
</div>
</section>

<!-- 08 Marketing & Analytics -->
<section>
<h2>08 Marketing & Analytics</h2>
<div class="mermaid">
graph LR
  A["Google Analytics / Firebase"]
  B["Meilisearch Logs"]
  C["Bunny Analytics"]
  D["Redis Counters"]
  E["Prometheus / Grafana"]
  A --> B --> C --> D --> E
</div>
</section>

<footer>
  <button onclick="window.scrollTo({top:0,behavior:'smooth'})">â¬† Back to Top</button>
</footer>

<!-- Mermaid runtime -->
<script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
<script>
  mermaid.initialize({ startOnLoad:true, theme:"default" });
</script>

</body>
</html>
